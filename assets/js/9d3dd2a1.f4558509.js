"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1721],{277:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>o,toc:()=>i});var a=r(4848),d=r(8453);const t={},s="Upgrading Kubernetes with kubeadm",o={id:"launchpad/advanced-tutorials/kubeadm-upgrade-nodes",title:"Upgrading Kubernetes with kubeadm",description:"In this guide we will use as an example upgrading from kubernetes v1.28.1 to v1.28.3",source:"@site/docs/launchpad/advanced-tutorials/kubeadm-upgrade-nodes.md",sourceDirName:"launchpad/advanced-tutorials",slug:"/launchpad/advanced-tutorials/kubeadm-upgrade-nodes",permalink:"/launchpad/advanced-tutorials/kubeadm-upgrade-nodes",draft:!1,unlisted:!1,editUrl:"https://github.com/graphops/docs/edit/main/docs/launchpad/advanced-tutorials/kubeadm-upgrade-nodes.md",tags:[],version:"current",frontMatter:{},sidebar:"launchpadSidebar",previous:{title:"Upgrading Kubernetes ClusterConfig with kubeadm",permalink:"/launchpad/advanced-tutorials/kubeadm-upgrade-cluster-config"},next:{title:"Kubernetes Guide - Bootstrapping with Kubeadm",permalink:"/launchpad/advanced-tutorials/kubernetes-create-cluster-with-kubeadm"}},l={},i=[{value:"Upgrade Control-Plane Nodes",id:"upgrade-control-plane-nodes",level:2},{value:"Upgrade remaining Control-Plane Nodes",id:"upgrade-remaining-control-plane-nodes",level:2},{value:"Upgrade Worker Nodes",id:"upgrade-worker-nodes",level:2}];function c(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"upgrading-kubernetes-with-kubeadm",children:"Upgrading Kubernetes with kubeadm"})}),"\n",(0,a.jsx)(n.p,{children:"In this guide we will use as an example upgrading from kubernetes v1.28.1 to v1.28.3"}),"\n",(0,a.jsx)(n.p,{children:"The the control-plane nodes must be upgraded first, followed by the worker nodes."}),"\n",(0,a.jsx)(n.h2,{id:"upgrade-control-plane-nodes",children:"Upgrade Control-Plane Nodes"}),"\n",(0,a.jsx)(n.p,{children:"Pick a control-plane node to be the first to upgrade, followed by:"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"1:"})," Upgrading kubeadm and kubectl to the latest patch version of the desired major version:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"apt-get update\napt-mark unhold kubeadm\napt-get install -y kubeadm='1.28.3-*'\napt-mark hold kubeadm\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"2:"})," Verify the upgrade plan:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubeadm upgrade plan v1.28.3\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"3:"})," Drain the node:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"kubectl drain <node-name> --ignore-daemonsets\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"4:"})," Perform the upgrade:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubeadm upgrade apply v1.28.3\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"5:"})," Upgrade the node's CRI-O or other container runtime to an appropriate version if need be. For CRI-O that would be changing the minor version in the repositories added to ",(0,a.jsx)(n.code,{children:"/etc/apt/sources.list.d"})," and then running:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"apt-get update\napt-get install cri-o cri-o-runc\nsystemctl daemon-reload\nsystemctl restart crio\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"6:"})," Upgrade kubelet and kubectl"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"apt-get update\napt-mark unhold kubelet\napt-mark unhold kubectl\napt-get install -y kubelet='1.28.3-*'\napt-get install -y kubectl='1.28.3-*'\napt-mark hold kubelet\napt-mark hold kubectl\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"7:"})," Restart kubelet"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"systemctl daemon-reload\nsystemctl restart kubelet\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"8:"})," Uncordon the node"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"kubectl uncordon <node-name>\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"9:"})," Possibly, upgrade CNI. Particularly if it's a minor version upgrade there may be a need to update the CNI to a new version as well according to the vendor's release notes for the upgrade process"]}),"\n",(0,a.jsx)(n.h2,{id:"upgrade-remaining-control-plane-nodes",children:"Upgrade remaining Control-Plane Nodes"}),"\n",(0,a.jsx)(n.p,{children:"For the remaining control-plane nodes, execute steps 1 to 8, one at a time but:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"step 2 is skipped, no need to plan the upgrade anymore"}),"\n",(0,a.jsx)(n.li,{children:"step 4 is replaced by:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubeadm upgrade node\n"})}),"\n",(0,a.jsx)(n.h2,{id:"upgrade-worker-nodes",children:"Upgrade Worker Nodes"}),"\n",(0,a.jsx)(n.p,{children:"After all the control-plane nodes are upgraded, it's time to upgrade your worker nodes by following the previous steps from 1 to 8 but:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"step 2 is skipped"}),"\n",(0,a.jsx)(n.li,{children:"step 4 is replaced by:"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubeadm upgrade node\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.em,{children:"Note"}),": You can upgrade as many worker nodes in parallel as you see fit and/or find adequate to your availability requirements, as the nodes being upgraded will be drained from workloads."]})]})}function u(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>o});var a=r(6540);const d={},t=a.createContext(d);function s(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:s(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);