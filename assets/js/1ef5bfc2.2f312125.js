"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5192],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>u});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var d=n.createContext({}),s=function(e){var t=n.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},p=function(e){var t=s(e.components);return n.createElement(d.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,d=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=s(a),u=i,c=m["".concat(d,".").concat(u)]||m[u]||h[u]||r;return a?n.createElement(c,o(o({ref:t},p),{},{components:a})):n.createElement(c,o({ref:t},p))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=m;var l={};for(var d in t)hasOwnProperty.call(t,d)&&(l[d]=t[d]);l.originalType=e,l.mdxType="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},4510:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var n=a(7462),i=(a(7294),a(3905));const r={sidebar_position:1},o="\ud83d\udcdf POI Radio",l={unversionedId:"graphcast/radios/poi-radio",id:"graphcast/radios/poi-radio",title:"\ud83d\udcdf POI Radio",description:"The source code for the POI Radio is available here.",source:"@site/docs/graphcast/radios/poi-radio.md",sourceDirName:"graphcast/radios",slug:"/graphcast/radios/poi-radio",permalink:"/graphcast/radios/poi-radio",draft:!1,editUrl:"https://github.com/graphops/docs/edit/main/docs/graphcast/radios/poi-radio.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"gnSidebar",previous:{title:"\ud83e\uddd1\u200d\ud83d\udcbb Radio Development",permalink:"/graphcast/sdk/radio-dev"}},d={},s=[{value:"Introduction",id:"introduction",level:2},{value:"Getting Started",id:"getting-started",level:2},{value:"Quickstart",id:"quickstart",level:3},{value:"Steps",id:"steps",level:5},{value:"Configuration",id:"configuration",level:2},{value:"Mainnet",id:"mainnet",level:3},{value:"Testnet (Goerli)",id:"testnet-goerli",level:3},{value:"Alternative options for using the POI Radio",id:"alternative-options-for-using-the-poi-radio",level:2},{value:"Building the image using the Dockerfile locally",id:"building-the-image-using-the-dockerfile-locally",level:4},{value:"Prerequisites",id:"prerequisites",level:5},{value:"Running the POI Radio inside a Docker container",id:"running-the-poi-radio-inside-a-docker-container",level:5},{value:"Using a pre-built binary",id:"using-a-pre-built-binary",level:3},{value:"Building POI Radio locally",id:"building-poi-radio-locally",level:3},{value:"Prerequisites",id:"prerequisites-1",level:4},{value:"Running the POI Radio natively",id:"running-the-poi-radio-natively",level:4},{value:"More details",id:"more-details",level:2},{value:"Fetching active allocations",id:"fetching-active-allocations",level:3},{value:"Gathering and comparing normalised POIs",id:"gathering-and-comparing-normalised-pois",level:3},{value:"Monitoring the Radio",id:"monitoring-the-radio",level:3}],p={toc:s};function h(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"-poi-radio"},"\ud83d\udcdf POI Radio"),(0,i.kt)("p",null,"The source code for the POI Radio is available ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/graphops/poi-radio"},"here"),"."),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"The key requirement for an Indexer to earn indexing rewards is to submit a valid Proof of Indexing (POI) promptly. The importance of valid POIs causes many Indexers to alert each other on subgraph health in community discussions. To alleviate the Indexer workload, this Radio utilized Graphcast SDK to exchange and aggregate POI along with a list of Indexer on-chain identities that can be used to trace reputations. With the pubsub pattern, the Indexer can get notified as soon as other indexers (with majority of stake) publish a POI different from the local POI."),(0,i.kt)("h2",{id:"getting-started"},"Getting Started"),(0,i.kt)("p",null,"Before you follow any of the instructions below, please make sure you have a Graphcast ID registered for your on-chain Indexer address."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"You can connect a Graphcast ID address to your Indexer address (with a 1:1 relationship) using our very own ",(0,i.kt)("strong",{parentName:"p"},"Registry contract"),", we have ",(0,i.kt)("a",{parentName:"p",href:"https://etherscan.io/address/0x89f97698d6006f25570cd2e31737d3d22aedcbcf"},"one for mainnet")," and ",(0,i.kt)("a",{parentName:"p",href:"https://goerli.etherscan.io/address/0x26ebbA649FAa7b56FDB8DE9Ea17aF3504B76BFA0"},"one for testnet")," (on Goerli). You need to use your Indexer or Operator wallet to call the ",(0,i.kt)("inlineCode",{parentName:"p"},"setGraphcastIDFor")," function, providing the Indexer address, as well as the address you wish to use as a Graphcast ID. Note that the Graphcast ID address must be different from the wallet you are calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"setGraphcastIDFor"),"function from. It also has to not be already registered as a Graphcast ID for another Indexer address, you can check if it's available by calling the ",(0,i.kt)("inlineCode",{parentName:"p"},"graphcastIDRegistered")," function.")),(0,i.kt)("h3",{id:"quickstart"},"Quickstart"),(0,i.kt)("h5",{id:"steps"},"Steps"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Pull the POI Radio image")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker pull ghcr.io/graphops/poi-radio:latest\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},"Run the image, providing the required environment variables. Here's a sample testnet configuration:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'docker run \\\n-e ETH_NODE="ETH_NODE" \\\n-e PRIVATE_KEY="GRAPHCAST_ID_PRIVATE_KEY" \\\n-e GRAPH_NODE_STATUS_ENDPOINT="http://host.docker.internal:8030/graphql" \\\n-e REGISTRY_SUBGRAPH="https://api.thegraph.com/subgraphs/name/hopeyen/graphcast-registry-goerli" \\\n-e NETWORK_SUBGRAPH="https://gateway.testnet.thegraph.com/network" \\\n-e GRAPHCAST_NETWORK="testnet" \\\n-e RUST_LOG="off,hyper=off,graphcast_sdk=debug,poi_radio=debug" \\\nghcr.io/graphops/poi-radio\n')),(0,i.kt)("p",null,"In the configuration table below is the full list of environment variables you can use, along with example values."),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("h3",{id:"mainnet"},"Mainnet"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Name"),(0,i.kt)("th",{parentName:"tr",align:null},"Example"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ETH_NODE")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://mainnet.infura.io/v3/<API_KEY>"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"PRIVATE_KEY")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"GRAPH_NODE_STATUS_ENDPOINT")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"http://localhost:8030/graphql")," or ",(0,i.kt)("inlineCode",{parentName:"td"},"http://host.docker.internal:8030/graphql")," for Docker")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"REGISTRY_SUBGRAPH")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://thegraph.com/hosted-service/subgraph/hopeyen/graphcast-registry-mainnet"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"NETWORK_SUBGRAPH")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://gateway.thegraph.com/network"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"GRAPHCAST_NETWORK")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"mainnet"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"COLLECT_MESSAGE_DURATION")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},"Defaults to 30 seconds")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"WAKU_HOST")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},"Defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"127.0.0.1"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"WAKU_PORT")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},"Defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"8546"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"WAKU_NODE_KEY")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},"Defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"None"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"BOOT_NODE_ADDRESSES")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},'"addr1, addr2, addr3" (defaults to ',(0,i.kt)("inlineCode",{parentName:"td"},"None"),")")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SLACK_TOKEN")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"xoxp-0123456789-0123456789-0123456789-0123456789")," (defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"None"),")")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SLACK_WEBHOOK")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://hooks.slack.com/services/<ID>/<ID>/<TOKEN>")," (defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"None"),")")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"RUST_LOG")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"graphcast_sdk=debug,poi_radio=debug"),", defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"info")," for everything")))),(0,i.kt)("h3",{id:"testnet-goerli"},"Testnet (Goerli)"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Name"),(0,i.kt)("th",{parentName:"tr",align:null},"Example"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ETH_NODE")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://goerli.infura.io/v3/<API_KEY>"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"PRIVATE_KEY")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"GRAPH_NODE_STATUS_ENDPOINT")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"http://localhost:8030/graphql")," or ",(0,i.kt)("inlineCode",{parentName:"td"},"http://host.docker.internal:8030/graphql")," for Docker")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"REGISTRY_SUBGRAPH")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://api.thegraph.com/subgraphs/name/hopeyen/graphcast-registry-goerli"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"NETWORK_SUBGRAPH")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://gateway.testnet.thegraph.com/network"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"GRAPHCAST_NETWORK")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"testnet"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"COLLECT_MESSAGE_DURATION")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},"Defaults to 30 seconds")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"WAKU_HOST")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},"Defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"127.0.0.1"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"WAKU_PORT")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},"Defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"8546"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"WAKU_NODE_KEY")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},"Defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"None"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"BOOT_NODE_ADDRESSES")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},'"addr1, addr2, addr3" (defaults to ',(0,i.kt)("inlineCode",{parentName:"td"},"None"),")")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SLACK_TOKEN")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"xoxp-0123456789-0123456789-0123456789-0123456789")," (defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"None"),")")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"SLACK_WEBHOOK")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"https://hooks.slack.com/services/<ID>/<ID>/<TOKEN>")," (defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"None"),")")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"RUST_LOG")," (Optional)"),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"graphcast_sdk=debug,poi_radio=debug"),", defaults to ",(0,i.kt)("inlineCode",{parentName:"td"},"info")," for everything")))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"SLACK_TOKEN")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"SLACK_WEBHOOK")," are used for POI divergence notifications in a Slack channel."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"WAKU_HOST")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"WAKU_PORT")," specify where the Graphcast node (included in all Radios) runs. If you want to run multiple Radios, or multiple instances of the same Radio, you should run them on different ports."),(0,i.kt)("p",null,"If you want to customize the log level, you can toggle ",(0,i.kt)("inlineCode",{parentName:"p"},"RUST_LOG")," environment variable. Here's an example configuration to get more verbose logging:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'RUST_LOG="off,hyper=off,graphcast_sdk=debug,poi_radio=debug"\n')),(0,i.kt)("h2",{id:"alternative-options-for-using-the-poi-radio"},"Alternative options for using the POI Radio"),(0,i.kt)("h4",{id:"building-the-image-using-the-dockerfile-locally"},"Building the image using the Dockerfile locally"),(0,i.kt)("p",null,"If you want to make any changes to the POI Radio codebase, you can use this option."),(0,i.kt)("h5",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Clone this repo and ",(0,i.kt)("inlineCode",{parentName:"li"},"cd")," into it"),(0,i.kt)("li",{parentName:"ol"},"Create a ",(0,i.kt)("inlineCode",{parentName:"li"},".env")," file that includes at least the required environment variables. To see the full list of environment variables you can provide, check out the ",(0,i.kt)("a",{parentName:"li",href:"#configuration"},"Configuration")," section.")),(0,i.kt)("h5",{id:"running-the-poi-radio-inside-a-docker-container"},"Running the POI Radio inside a Docker container"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker-compose up -d\n")),(0,i.kt)("h3",{id:"using-a-pre-built-binary"},"Using a pre-built binary"),(0,i.kt)("p",null,"We also provide pre-built binaries for Ubuntu and MacOS, which you can find in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Assets")," section on each release in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/graphops/poi-radio/releases"},"releases page")," on Github. Simply download the binary, make it executable (",(0,i.kt)("inlineCode",{parentName:"p"},"chmod a+x ./poi-radio-{TAG}-{SYSTEM}"),") and then run it (using ",(0,i.kt)("inlineCode",{parentName:"p"},"./poi-radio-{TAG}-{SYSTEM}"),")."),(0,i.kt)("h3",{id:"building-poi-radio-locally"},"Building POI Radio locally"),(0,i.kt)("p",null,"To have full control over the POI Radio code and run it directly on your machine (without Docker) you can use this option."),(0,i.kt)("h4",{id:"prerequisites-1"},"Prerequisites"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Clone this repo and ",(0,i.kt)("inlineCode",{parentName:"li"},"cd")," into it"),(0,i.kt)("li",{parentName:"ol"},"Make sure you have the following installed:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.rust-lang.org/tools/install"},"Rust")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://go.dev/doc/install"},"Go")),(0,i.kt)("li",{parentName:"ul"},"Build tools (e.g. the ",(0,i.kt)("inlineCode",{parentName:"li"},"build-essentials")," package for Debian-based Linux distributions or ",(0,i.kt)("a",{parentName:"li",href:"https://mac.install.guide/commandlinetools/index.html"},"Xcode Command Line Tools")," for MacOS)"),(0,i.kt)("li",{parentName:"ul"},"C compiler (e.g. the ",(0,i.kt)("inlineCode",{parentName:"li"},"clang")," package for Debian-based Linux distribution or ",(0,i.kt)("a",{parentName:"li",href:"https://mac.install.guide/commandlinetools/index.html"},"Xcode Command Line Tools")," for MacOS)"),(0,i.kt)("li",{parentName:"ul"},"OpenSSL (e.g. the ",(0,i.kt)("inlineCode",{parentName:"li"},"libssl-dev")," package for Debian-based Linux distribution or ",(0,i.kt)("inlineCode",{parentName:"li"},"openssl")," for MacOS)"),(0,i.kt)("li",{parentName:"ul"},"PostreSQL libraries and headers (e.g. the ",(0,i.kt)("inlineCode",{parentName:"li"},"libpq-dev")," package for Debian-based Linux distribution or ",(0,i.kt)("inlineCode",{parentName:"li"},"postgresql")," for MacOS)")),(0,i.kt)("ol",{start:3},(0,i.kt)("li",{parentName:"ol"},"You have ",(0,i.kt)("strong",{parentName:"li"},"Graph Node")," syncing your indexer's on-chain allocations."),(0,i.kt)("li",{parentName:"ol"},"You have created a ",(0,i.kt)("inlineCode",{parentName:"li"},".env")," file that includes at least the required environment variables. To see the full list of environment variables you can provide, check out the ",(0,i.kt)("a",{parentName:"li",href:"#configuration"},"Configuration")," section.")),(0,i.kt)("h4",{id:"running-the-poi-radio-natively"},"Running the POI Radio natively"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"cargo run\n")),(0,i.kt)("h2",{id:"more-details"},"More details"),(0,i.kt)("h3",{id:"fetching-active-allocations"},"Fetching active allocations"),(0,i.kt)("p",null,"The POI Radio is responsible for reading active allocations of the Radio operator's corresponding Indexer. It periodically polls the Graph Node for new blocks on all relevant networks and constructs Graphcast topics on each allocation identified by subgraph deployment IPFS hash."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"The relevant networks are those corresponding to the subgraphs that have active allocations.")),(0,i.kt)("p",null,"The Radio fetches new active allocations at a set interval (currently set to 2 minutes) to ensure that it is processing the latest information. Chainheads for these networks are updated with data from the Graph Node, and the Radio ensures that it is always using the latest chainhead when processing messages."),(0,i.kt)("h3",{id:"gathering-and-comparing-normalised-pois"},"Gathering and comparing normalised POIs"),(0,i.kt)("p",null,"At a given interval, the Radio fetches the normalised POI for each deployment. This interval is defined in blocks different for each network."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"These are the current intervals:"),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"goerli - 2 blocks"),(0,i.kt)("li",{parentName:"ul"},"eth mainnet - 10 blocks"),(0,i.kt)("li",{parentName:"ul"},"gnosis - 5 blocks"),(0,i.kt)("li",{parentName:"ul"},"hardhat - 5 blocks"),(0,i.kt)("li",{parentName:"ul"},"arbitrum one - 5 blocks"),(0,i.kt)("li",{parentName:"ul"},"arbitrum goerli - 5 blocks"),(0,i.kt)("li",{parentName:"ul"},"avalanche - 5 blocks"),(0,i.kt)("li",{parentName:"ul"},"polygon - 5 blocks"),(0,i.kt)("li",{parentName:"ul"},"celo - 5 blocks"),(0,i.kt)("li",{parentName:"ul"},"optimism - 5 blocks"))),(0,i.kt)("p",null,"It then saves those nPOIs in an in-memory map. These nPOIs are referred to as ",(0,i.kt)("em",{parentName:"p"},"local")," POIs since they are generated by the Radio. As other Indexers running the Radio start doing the same, messages start propagating through the network. The Radio handles each message and adds the POI from it in another in-memory map. These POIs are referred to as ",(0,i.kt)("em",{parentName:"p"},"remote")," POIs since they are received from other network participants."),(0,i.kt)("p",null,"The messages include a nonce (UNIX timestamp), block number, signature (used to derive the sender's on-chain Indexer address) and network. Before saving an entry to the map, the Radio operator verifies through the Graph network subgraph for the sender's on-chain identity and amount of tokens staked, which is used during comparisons later on."),(0,i.kt)("p",null,"At another interval, the Radio compares the local POIs with the collected remote ones. That interval can be set by the operator, the default currently is 30 seconds. The remote POIs are sorted so that for each subgraph (on each block), the POI that is backed by the most on-chain stake is selected. This means that the combined stake of all Indexers that attested to it is considered, not just the highest staking Indexer. The top POI is then compared with the local POI for that subgraph at that block to determine consensus."),(0,i.kt)("p",null,"After a successful comparison, the attestations that have been checked are removed from the store."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"There are other small delays in the attestation and comparison process that can make it tricky to calculate the exact attestation and comparison times. Also, since the Radio is relying on the Graph Node to get latest blocks (currently it checks for the latest chainhead block every 5 seconds) pinpointing the exact time of those events becomes difficult. All this is to say that operators should expect a certain level of variation in the exact time that the Radio sends and proccesses messages.")),(0,i.kt)("h3",{id:"monitoring-the-radio"},"Monitoring the Radio"),(0,i.kt)("p",null,"If the Radio operator has set up a Slack Bot integration and the Radio finds a POI mismatch, it sends alerts to the designated channel. The operator can also inspect the logs to see if the Radio is functioning properly, if it's sending and receiving messages, if it's comparing normalised POIs, if there is a found POI mismatch, etc."))}h.isMDXComponent=!0}}]);