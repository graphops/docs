<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-graphcast/sdk/radio-dev">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Radio Development | GraphOps Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.graphops.xyz/graphcast/sdk/radio-dev"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Radio Development | GraphOps Docs"><meta data-rh="true" name="description" content="Do you want to build robust, peer-to-peer messaging apps that automatically exchange valuable data with other Indexers in real time? Do you have an idea for what data could be useful to share that could lead to greater communication efficiency in The Graph network as a whole? Then you want to build a Radio on top of the Graphcast network."><meta data-rh="true" property="og:description" content="Do you want to build robust, peer-to-peer messaging apps that automatically exchange valuable data with other Indexers in real time? Do you have an idea for what data could be useful to share that could lead to greater communication efficiency in The Graph network as a whole? Then you want to build a Radio on top of the Graphcast network."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.graphops.xyz/graphcast/sdk/radio-dev"><link data-rh="true" rel="alternate" href="https://docs.graphops.xyz/graphcast/sdk/radio-dev" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.graphops.xyz/graphcast/sdk/radio-dev" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="GraphOps Docs RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="GraphOps Docs Atom Feed"><link rel="stylesheet" href="/assets/css/styles.b3d4b999.css">
<link rel="preload" href="/assets/js/runtime~main.14a8a3ca.js" as="script">
<link rel="preload" href="/assets/js/main.02d941a0.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(e){}return e}()||function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="GraphOps Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="GraphOps Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Documentation</b></a><a class="navbar__item navbar__link" href="/launchpad/intro">Launchpad</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/graphcast/intro">Graphcast</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/graphops/docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Docs on GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/graphcast/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/graphcast/design-principles">Design Principles</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/graphcast/sdk/intro">Graphcast SDK</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/sdk/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/graphcast/sdk/radio-dev">Radio Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/sdk/registry">Registry Contract</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" href="/graphcast/radios/subgraph-radio/intro">Radios</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="true" tabindex="0" href="/graphcast/radios/subgraph-radio/intro">Subgraph Radio</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/radios/subgraph-radio/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/radios/subgraph-radio/poi-cross-checking">POI Cross-checking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/radios/subgraph-radio/subgraph-upgrade-presyncing">Subgraph Upgrade Pre-syncing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/radios/subgraph-radio/monitoring">Notifications and Monitoring</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/radios/subgraph-radio/advanced-configuration">Advanced Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/radios/subgraph-radio/http-server">HTTP Server</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/radios/graphcast-cli">Graphcast CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/graphcast/radios/listener-radio">Listener Radio</a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Graphcast SDK</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Radio Development</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Radio Development</h1><p>Do you want to build robust, peer-to-peer messaging apps that automatically exchange valuable data with other Indexers in real time? Do you have an idea for what data could be useful to share that could lead to greater communication efficiency in The Graph network as a whole? Then you want to build a Radio on top of the Graphcast network.</p><p>For a more complex and full example of the Graphcast SDK being used to create a Subgraph Radio, take a look at this <a href="https://github.com/graphops/subgraph-radio" target="_blank" rel="noopener noreferrer">repo</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="a-simple-ping-pong-example">A simple ping pong example<a href="#a-simple-ping-pong-example" class="hash-link" aria-label="Direct link to A simple ping pong example" title="Direct link to A simple ping pong example">​</a></h2><p>Let&#x27;s take a look at the simplest possible example of a Radio, built on top of Graphcast - a ping pong app. When one participant sends <code>Ping</code>, all the others in the network are listening on the ping pong topic will send <code>Pong</code> back. Pretty straightforward.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="register-a-graphcast-id">Register a Graphcast ID<a href="#register-a-graphcast-id" class="hash-link" aria-label="Direct link to Register a Graphcast ID" title="Direct link to Register a Graphcast ID">​</a></h3><p>We recommend that you register a Graphcast ID for your on-chain Indexer address. You can learn what a Graphcast ID is and how to register one <a href="https://docs.graphops.xyz/graphcast/sdk/registry#register-a-graphcast-id" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Once you complete those steps you will have a Graphcast ID that is authorized to sign messages on behalf of your Indexer.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="populate-your-env-file">Populate your <code>.env</code> file<a href="#populate-your-env-file" class="hash-link" aria-label="Direct link to populate-your-env-file" title="Direct link to populate-your-env-file">​</a></h3><p>You now need to export a few environment variables:</p><table><thead><tr><th>Name</th><th>Description and examples</th></tr></thead><tbody><tr><td><code>PRIVATE_KEY</code></td><td>Private key to the Graphcast ID wallet or Indexer Operator wallet (Precendence over <code>MNEMONICS</code>).<br>Example: <code>0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef</code></td></tr><tr><td><code>REGISTRY_SUBGRAPH</code></td><td>URL to the Graphcast Registry subgraph for your network. Check <a href="/graphcast/sdk/registry#subgraph-apis">APIs</a> for your preferred network</td></tr><tr><td><code>NETWORK_SUBGRAPH</code></td><td>URL to the Graph Network subgraph. Check <a href="/graphcast/sdk/registry#subgraph-apis">APIs</a> for your preferred network</td></tr><tr><td><code>GRAPHCAST_NETWORK</code></td><td>The Graphcast Messaging fleet and pubsub namespace to use. For this example you should use <code>testnet</code></td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="a-few-dependencies">A few dependencies<a href="#a-few-dependencies" class="hash-link" aria-label="Direct link to A few dependencies" title="Direct link to A few dependencies">​</a></h3><p>Make sure you have the following installed:</p><ul><li><a href="https://www.rust-lang.org/tools/install" target="_blank" rel="noopener noreferrer">Rust</a></li><li><a href="https://go.dev/doc/install" target="_blank" rel="noopener noreferrer">Go</a></li><li>Build tools (e.g. the <code>build-essentials</code> package for Debian-based Linux distributions or <a href="https://mac.install.guide/commandlinetools/index.html" target="_blank" rel="noopener noreferrer">Xcode Command Line Tools</a> for MacOS)</li><li>C compiler (e.g. the <code>clang</code> package for Debian-based Linux distribution or <a href="https://mac.install.guide/commandlinetools/index.html" target="_blank" rel="noopener noreferrer">Xcode Command Line Tools</a> for MacOS)</li><li>OpenSSL (e.g. the <code>libssl-dev</code> package for Debian-based Linux distribution or <code>openssl</code> for MacOS)</li><li>PostreSQL libraries and headers (e.g. the <code>libpq-dev</code> package for Debian-based Linux distribution or <code>postgresql</code> for MacOS)</li></ul><p>Start off with a new Rust project (<code>cargo new ping-pong</code>). Then add the following dependencies to you <code>Cargo.toml</code> file:</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">graphcast-sdk = &quot;0.4.0&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">once_cell = &quot;1.15&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tokio = { version = &quot;1.1.1&quot;, features = [&quot;full&quot;] }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">anyhow = &quot;1.0.39&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ethers = &quot;1.0.0&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dotenv = &quot;0.15.0&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tracing = &quot;0.1&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ethers-contract = &quot;1.0.0&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ethers-core = &quot;1.0.0&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ethers-derive-eip712 = &quot;1.0.0&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">prost = &quot;0.11&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">serde = &quot;1.0.147&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">serde_derive = &quot;1.0.114&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-imports">The imports<a href="#the-imports" class="hash-link" aria-label="Direct link to The imports" title="Direct link to The imports">​</a></h3><p>Open your <code>main.rs</code> file and add the following imports:</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// For date and time utils</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use chrono::Utc;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Load environment variables from .env file</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use dotenv::dotenv;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Import Arc and Mutex for thread-safe sharing of data across threads</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use std::sync::{Arc, Mutex};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Import Graphcast SDK types and functions for agent configuration, message handling, and more</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use graphcast_sdk::graphcast_agent::{GraphcastAgent, GraphcastAgentConfig};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Import sleep and Duration for handling time intervals and thread delays</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use std::{thread::sleep, time::Duration};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Import AsyncMutex for asynchronous mutual exclusion of shared resources</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use tokio::sync::Mutex as AsyncMutex;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Import tracing macros for logging and diagnostic purposes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use tracing::{debug, error, info, trace};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Import SimpleMessage from the crate&#x27;s types module</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use types::SimpleMessage;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Import Config from the crate&#x27;s config module</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use config::Config;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use crate::types::{GRAPHCAST_AGENT, MESSAGES};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Include the local config and types modules</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mod config;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">mod types;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="structure">Structure<a href="#structure" class="hash-link" aria-label="Direct link to Structure" title="Direct link to Structure">​</a></h3><p>Everything we need will be inside the <code>main()</code> function. And since we&#x27;ll be using async code we have to annotate it with <code>#[tokio::main]</code>, we can start off with something as simple as:</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[tokio::main]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">async fn main() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // TODO: Radio logic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Before diving into the contents of the <code>main</code> function, let&#x27;s quickly populate the other two files we need - <code>config.rs</code> and <code>types.rs</code>.</p><p>Let&#x27;s take a look at types.rs first:</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">use async_graphql::SimpleObject;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use ethers_contract::EthAbiType;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use ethers_core::types::transaction::eip712::Eip712;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use ethers_derive_eip712::*;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use graphcast_sdk::graphcast_agent::GraphcastAgent;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use prost::Message;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use serde::{Deserialize, Serialize};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Import the OnceCell container for lazy initialization of global/static data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use once_cell::sync::OnceCell;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use std::sync::{Arc, Mutex};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// A global static (singleton) instance of A GraphcastMessage vector.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// It is used to save incoming messages after they&#x27;ve been validated, in order</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// defer their processing for later, because async code is required for the processing but</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// it is not allowed in the handler itself.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub static MESSAGES: OnceCell&lt;Arc&lt;Mutex&lt;Vec&lt;SimpleMessage&gt;&gt;&gt;&gt; = OnceCell::new();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// The Graphcast Agent instance must be a global static variable (for the time being).</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// This is because the Radio handler requires a static immutable context and</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// the handler itself is being passed into the Graphcast Agent, so it needs to be static as well.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub static GRAPHCAST_AGENT: OnceCell&lt;GraphcastAgent&gt; = OnceCell::new();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// Make a test radio type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Eip712, EthAbiType, Clone, Message, Serialize, Deserialize, SimpleObject)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[eip712(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;Graphcast Ping-Pong Radio&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    version = &quot;0&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    chain_id = 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    verifying_contract = &quot;0xc944e90c64b2c07662a292be6244bdf05cda44a7&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct SimpleMessage {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[prost(string, tag = &quot;1&quot;)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub identifier: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[prost(string, tag = &quot;2&quot;)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub content: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl SimpleMessage {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn new(identifier: String, content: String) -&gt; Self {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        SimpleMessage {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            identifier,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            content,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn radio_handler(&amp;self) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        MESSAGES</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .get()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .expect(&quot;Could not retrieve messages&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .lock()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .expect(&quot;Could not get lock on messages&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .push(self.clone());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>SimpleMessage</code> defines the structure that all messages for this Radio must follow.</p><p><code>RadioPayloadMessage</code> is decorated with several macros - #<!-- -->[derive(Eip712, EthAbiType, Clone, Message, Serialize, Deserialize)]<!-- -->, which automatically implement certain traits that are required by the SDK.</p><p>The <code>#[eip712]</code> macro is used to define information that is used in EIP-712, a standard for structuring typed data in Ethereum transactions.</p><p>Now let&#x27;s see the <code>config.rs</code> file:</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">use clap::Parser;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use ethers::signers::WalletError;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use graphcast_sdk::build_wallet;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use graphcast_sdk::graphcast_agent::message_typing::IdentityValidation;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use graphcast_sdk::init_tracing;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use graphcast_sdk::wallet_address;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use serde::{Deserialize, Serialize};</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">use tracing::info;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[derive(Clone, Debug, Parser, Serialize, Deserialize)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#[clap(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name = &quot;ping-pong-radio&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    about = &quot;A simple example for using the Graphcast SDK to build Radios&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    author = &quot;GraphOps&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pub struct Config {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[clap(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_name = &quot;ENDPOINT&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env = &quot;GRAPH_NODE_STATUS_ENDPOINT&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        help = &quot;API endpoint to the Graph Node Status Endpoint&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub graph_node_endpoint: Option&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[clap(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_name = &quot;KEY&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_parser = Config::parse_key,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env = &quot;PRIVATE_KEY&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hide_env_values = true,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        help = &quot;Private key to the Graphcast ID wallet (Precendence over mnemonics)&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub private_key: Option&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[clap(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_name = &quot;KEY&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_parser = Config::parse_key,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env = &quot;MNEMONIC&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        hide_env_values = true,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        help = &quot;Mnemonic to the Graphcast ID wallet (first address of the wallet is used; Only one of private key or mnemonic is needed)&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub mnemonic: Option&lt;String&gt;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[clap(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_name = &quot;SUBGRAPH&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env = &quot;REGISTRY_SUBGRAPH&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        help = &quot;Subgraph endpoint to the Graphcast Registry&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        default_value = &quot;https://api.thegraph.com/subgraphs/name/hopeyen/graphcast-registry-goerli&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub registry_subgraph: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[clap(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_name = &quot;INDEXER_ADDRESS&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env = &quot;INDEXER_ADDRESS&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        help = &quot;Graph account corresponding to Graphcast operator&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub indexer_address: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[clap(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_name = &quot;SUBGRAPH&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env = &quot;NETWORK_SUBGRAPH&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        help = &quot;Subgraph endpoint to The Graph network subgraph&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        default_value = &quot;https://gateway.testnet.thegraph.com/network&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub network_subgraph: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[clap(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_name = &quot;LOG_FORMAT&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env = &quot;LOG_FORMAT&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        help = &quot;Support logging formats: pretty, json, full, compact&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long_help = &quot;pretty: verbose and human readable; json: not verbose and parsable; compact:  not verbose and not parsable; full: verbose and not parsible&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        possible_values = [&quot;pretty&quot;, &quot;json&quot;, &quot;full&quot;, &quot;compact&quot;],</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        default_value = &quot;full&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub log_format: String,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    #[clap(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_name = &quot;ID_VALIDATION&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        value_enum,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        env = &quot;ID_VALIDATION&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        default_value = &quot;valid-address&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        help = &quot;Identity validation mechanism for senders (message signers)&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        long_help = &quot;Identity validation mechanism for senders (message signers)\n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        no-check: all messages signer is valid, \n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        valid-address: signer needs to be an valid Eth address, \n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        graphcast-registered: must be registered at Graphcast Registry, \n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        graph-network-account: must be a Graph account, \n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        registered-indexer: must be registered at Graphcast Registry, correspond to and Indexer statisfying indexer minimum stake requirement, \n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        indexer: must be registered at Graphcast Registry or is a Graph Account, correspond to and Indexer statisfying indexer minimum stake requirement&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    )]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub id_validation: IdentityValidation,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">impl Config {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Parse config arguments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pub fn args() -&gt; Self {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // TODO: load config file before parse (maybe add new level of subcommands)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let config = Config::parse();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        init_tracing(config.log_format.clone()).expect(&quot;Could not set up global default subscriber for logger, check environmental variable `RUST_LOG` or the CLI input `log-level`&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        config</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Validate that private key as an Eth wallet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fn parse_key(value: &amp;str) -&gt; Result&lt;String, WalletError&gt; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // The wallet can be stored instead of the original private key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let wallet = build_wallet(value)?;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let addr = wallet_address(&amp;wallet);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        info!(address = addr, &quot;Resolved Graphcast id&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Ok(String::from(value))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This file defines the <code>Config</code> struct and its associated methods for handling configuration options of our Radio. This outlines the basic configuration that all Radios have to define.</p><p>The configuration options can be provided through command-line arguments, environment variables, or a combination of both. The <code>Config</code> struct parses and validates these options, it also initializes the tracing system for logging purposes.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="methods">Methods<a href="#methods" class="hash-link" aria-label="Direct link to Methods" title="Direct link to Methods">​</a></h4><ul><li><code>args()</code>: Parses and returns the configuration options from command-line arguments and environment variables.</li><li><code>parse_key(value: &amp;str)</code>: Validates a given private key by attempting to create an Ethereum wallet with it. Returns the private key as a string if successful.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="instantiate-the-essentials">Instantiate the essentials<a href="#instantiate-the-essentials" class="hash-link" aria-label="Direct link to Instantiate the essentials" title="Direct link to Instantiate the essentials">​</a></h3><p>From here on, all following code will be in the <code>main</code> function. To start off, we define a name for our Radio, read the provided environment variables and instantiate our configuration struct.</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This can be any string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let radio_name = &quot;ping-pong&quot;.to_string();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Loads the environment variables from .env</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dotenv().ok();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Instantiates the configuration struct based on provided environment variables or CLI args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let config = Config::args();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let _parent_span = tracing::info_span!(&quot;main&quot;).entered();</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s instantiate a few variables that will do all the heavy lifting for us.</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Subtopics are optionally provided and used as the content topic identifier of the message subject,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// if not provided then they are usually generated based on indexer allocations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let subtopics: Vec&lt;String&gt; = vec![&quot;ping-pong-content-topic&quot;.to_string()];</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// GraphcastAgentConfig defines the configuration that the SDK expects from all Radios, regardless of their specific functionality</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let graphcast_agent_config = GraphcastAgentConfig::new(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config.private_key.expect(&quot;No private key provided&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config.indexer_address,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    radio_name,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config.registry_subgraph,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config.network_subgraph,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config.id_validation.clone(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    config.graph_node_endpoint,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    None,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Some(&quot;testnet&quot;.to_string()),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Some(subtopics),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    None,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    None,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    None,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    None,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Some(true),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Example ENR address</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Some(vec![String::from(&quot;enr:-JK4QBcfVXu2YDeSKdjF2xE5EDM5f5E_1Akpkv_yw_byn1adESxDXVLVjapjDvS_ujx6MgWDu9hqO_Az_CbKLJ8azbMBgmlkgnY0gmlwhAVOUWOJc2VjcDI1NmsxoQOUZIqKLk5xkiH0RAFaMGrziGeGxypJ03kOod1-7Pum3oN0Y3CCfJyDdWRwgiMohXdha3UyDQ&quot;)]),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    None,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">.await</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">.unwrap_or_else(|e| panic!(&quot;Could not create GraphcastAgentConfig: {e}&quot;));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>GraphcastAgentConfig</code> takes in an optional vector for content topics. Here we explicitly provide a singleton vector of &quot;ping-pong-content-topic&quot;, but you can define topics based on the radio&#x27;s use case needs. If you leave the field as None, then the agent will automatically fetch your indexer&#x27;s active allocations and create a list of topics in the format of <code>radio application name</code> + the allocated subgraph deployments&#x27; IPFS hash.</p><p>Next, we will instantiate a <code>GraphcastAgent</code>:</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">debug!(&quot;Initializing the Graphcast Agent&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let (graphcast_agent, waku_msg_receiver) = GraphcastAgent::new(graphcast_agent_config)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .await</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .expect(&quot;Could not create Graphcast agent&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>GraphcastAgent</code> is the main struct through which the Radios communicate with the SDK.</p><p>And lastly for the setup part, we need to run two one-off setters for <code>GraphcastAgent</code> and for the incoming messages store:</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// A one-off setter to load the Graphcast Agent into the global static variable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = GRAPHCAST_AGENT.set(graphcast_agent);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// A one-off setter to instantiate an empty vec before populating it with incoming messages</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">_ = MESSAGES.set(Arc::new(Mutex::new(vec![])));</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Awesome, we&#x27;re all set to start with the actual Radio logic now!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sending-messages">Sending messages<a href="#sending-messages" class="hash-link" aria-label="Direct link to Sending messages" title="Direct link to Sending messages">​</a></h3><p>We&#x27;ll define a helper function that holds the logic of sending messages to the Graphcast network:</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// Helper function to reuse message sending code</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">async fn send_message(payload: SimpleMessage) {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if let Err(e) = GRAPHCAST_AGENT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .get()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .expect(&quot;Could not retrieve Graphcast agent&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .send_message(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // The identifier can be any string that suits your Radio logic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            // If it doesn&#x27;t matter for your Radio logic (like in this case), you can just use a UUID or a hardcoded string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;ping-pong-content-topic&quot;,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            payload,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            Utc::now().timestamp(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        )</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        .await</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        error!(error = tracing::field::debug(&amp;e), &quot;Failed to send message&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again, the <code>identifier</code> that we define as <code>ping-pong-content-topic</code> can be any string that suits your Radio logic, if it doesn&#x27;t really matter for your use case (like in the ping-pong Radio case) you can just use a UUID or a hardcoded string.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="receiving-and-handling-messages">Receiving and handling messages<a href="#receiving-and-handling-messages" class="hash-link" aria-label="Direct link to Receiving and handling messages" title="Direct link to Receiving and handling messages">​</a></h3><p>We now know how to send message, but how do we receive and handle message from other network participants?</p><p>After <code>GossipAgent</code> validates the incoming messages, we provide a custom callback handler that specifies what to do with the message. In this handler we cache the message for later aggregation and processing, but depending on your Radio use case you are free any data storage option - a database, a custom data structure or a simple vector.</p><p>Here is a simple handler that does just that:</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// The handler specifies what to do with incoming messages.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This is where you can define multiple message types and how they gets handled by the radio</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// by chaining radio payload typed decode and handler functions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tokio::spawn(async move {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    for msg in waku_msg_receiver {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        trace!(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;Radio operator received a Waku message from Graphcast agent, now try to fit it to Graphcast Message with Radio specified payload&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let _ = GRAPHCAST_AGENT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .get()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .expect(&quot;Could not retrieve Graphcast agent&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .decoder::&lt;SimpleMessage&gt;(msg.payload())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .await</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .map(|msg| {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                msg.payload.radio_handler();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            })</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            .map_err(|err| {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                error!(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    error = tracing::field::debug(&amp;err),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                    &quot;Failed to handle Waku signal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                err</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">});</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">GRAPHCAST_AGENT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .get()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .expect(&quot;Could not retrieve Graphcast agent&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .register_handler()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .expect(&quot;Could not register handler&quot;);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-main-loop">The main loop<a href="#the-main-loop" class="hash-link" aria-label="Direct link to The main loop" title="Direct link to The main loop">​</a></h3><p>Great, we&#x27;re almost there! We have a way to pass messages back and forth 🏓. But sending a one-off message is no fun, we want to create some sort of scheduled and continuous logic of message exchange, and perhaps the easiest way to do that is to use a block number as cue.</p><p>We&#x27;ll start listening to Ethereum blocks coming from the Graph Node and on each block we&#x27;ll do a simple check - if the block number is even we&#x27;ll send a &quot;Ping&quot; message, and if it&#x27;s odd we&#x27;ll process the messages we&#x27;ve received. After processing the messages we&#x27;ll clear our store.</p><div class="language-Rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#243D42"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Rust codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let mut block_number = 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loop {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    block_number += 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    info!(block = block_number, &quot;🔗 Block number&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if block_number &amp; 2 == 0 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // If block number is even, send ping message</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let msg = SimpleMessage::new(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &quot;table&quot;.to_string(),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            std::env::args().nth(1).unwrap_or(&quot;Ping&quot;.to_string()),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        send_message(msg).await;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // If block number is odd, process received messages</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        let messages = AsyncMutex::new(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            MESSAGES</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .get()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .expect(&quot;Could not retrieve messages&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .lock()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                .expect(&quot;Could not get lock on messages&quot;),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        for msg in messages.lock().await.iter() {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            if msg.content == *&quot;Ping&quot; {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                let replay_msg = SimpleMessage::new(&quot;table&quot;.to_string(), &quot;Pong&quot;.to_string());</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                send_message(replay_msg).await;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        // Clear message store after processing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        messages.lock().await.clear();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Wait before next block check</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    sleep(Duration::from_secs(5));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-finished-radio">The finished Radio<a href="#the-finished-radio" class="hash-link" aria-label="Direct link to The finished Radio" title="Direct link to The finished Radio">​</a></h3><p>Congratulations, you&#x27;ve now written you first full Graphcast Radio! The finished code is also available in <a href="https://github.com/graphops/graphcast-sdk/tree/main/examples/ping-pong" target="_blank" rel="noopener noreferrer">this repo</a>, the only important difference is in the dependencies.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="thats-awesome-but-how-do-we-run-it">That&#x27;s awesome. But how do we run it?<a href="#thats-awesome-but-how-do-we-run-it" class="hash-link" aria-label="Direct link to That&#x27;s awesome. But how do we run it?" title="Direct link to That&#x27;s awesome. But how do we run it?">​</a></h3><p>You can start up the ping-pong Radio using <code>cargo run</code>.</p><p>You can spawn more instances of the <code>ping-pong</code> Radio and examine how they interact with each other in the terminal logs.</p><p>Now there&#x27;s just one more thing to do - have fun examining the logs &amp; be proud of yourself - you made it! 🥂 From here on out, the only limit to the Radios you can build is your own imagination.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/graphops/docs/edit/main/docs/graphcast/sdk/radio-dev.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/graphcast/sdk/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/graphcast/sdk/registry"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Registry Contract</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#a-simple-ping-pong-example" class="table-of-contents__link toc-highlight">A simple ping pong example</a><ul><li><a href="#register-a-graphcast-id" class="table-of-contents__link toc-highlight">Register a Graphcast ID</a></li><li><a href="#populate-your-env-file" class="table-of-contents__link toc-highlight">Populate your <code>.env</code> file</a></li><li><a href="#a-few-dependencies" class="table-of-contents__link toc-highlight">A few dependencies</a></li><li><a href="#the-imports" class="table-of-contents__link toc-highlight">The imports</a></li><li><a href="#structure" class="table-of-contents__link toc-highlight">Structure</a></li><li><a href="#instantiate-the-essentials" class="table-of-contents__link toc-highlight">Instantiate the essentials</a></li><li><a href="#sending-messages" class="table-of-contents__link toc-highlight">Sending messages</a></li><li><a href="#receiving-and-handling-messages" class="table-of-contents__link toc-highlight">Receiving and handling messages</a></li><li><a href="#the-main-loop" class="table-of-contents__link toc-highlight">The main loop</a></li><li><a href="#the-finished-radio" class="table-of-contents__link toc-highlight">The finished Radio</a></li><li><a href="#thats-awesome-but-how-do-we-run-it" class="table-of-contents__link toc-highlight">That&#39;s awesome. But how do we run it?</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Graph Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/graphprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/graphprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/graphprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Indexer Office Hours</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/TheGraphIOH" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCQ7G_cCufIVUdUUUf-jdoVA" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube Recordings<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://graphops.notion.site/Indexer-Office-Hours-952e0b50a65144768aab922e2c9d102a" target="_blank" rel="noopener noreferrer" class="footer__link-item">All Prior Calls &amp; Agendas<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">GraphOps</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/graphopsxyz" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/graphops" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://graphops.xyz" target="_blank" rel="noopener noreferrer" class="footer__link-item">Website<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"> </div></div></div></footer></div>
<script src="/assets/js/runtime~main.14a8a3ca.js"></script>
<script src="/assets/js/main.02d941a0.js"></script>
</body>
</html>